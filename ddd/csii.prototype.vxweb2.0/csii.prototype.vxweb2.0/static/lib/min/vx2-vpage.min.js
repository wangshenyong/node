!function(window,angular){"use strict";function indexOf(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(t===e[r])return r;return-1}function ngPageController(e,t,r,n,i,o,a){var l,$=this,s=r.onload,c=r.href;t.hide(),$.$element=t,$.$title=r.title,l=t.parent().data("$viewport"),$.$destroy=function(){$.$element=null},$.$index=parseInt(t.attr("page-index")),$.$load=function(r){function n(){o(t.contents())(e),$.$$loaded=!0,r.apply(l,[$.$index,$])}$.$$loaded?r.apply(l,[$.$index,$]):c?i(c,!0).then(function(e){t.html(e),n()},function(e){console.err(e)}):a.defer(function(){n(),e.$apply(null,"ng-page")})},$.$enable=function(r){t.show(),r&&r(),n.$broadcast("$pageContentLoaded",l.$id,$.$index,c,$.$title),e.$eval(s)},$.$disable=function(){t.hide()}}function ngPageDirective(e,t){return{restrict:"EA",terminal:!0,require:"ngPage",priority:99,controller:ngPageController,link:function(r,n,i,o){var a=n.parent().data("$viewport");"1"===n.attr("page-index")&&e(function(){t.$loadIndex(a,0)}),n.bind("$destroy",function(){o.$destroy()})}}}function $TargetsProvider(){function Factory(window,$location,$log,$rootScope){function forward(e,t,r){service.$targetProxy(e,t,r)}var TARGET_REG=/^#[+-]?\d+$/,service;return service={$viewports:{},$refreshCall:null,setRefreshCall:function(e){e&&(service.$refreshCall=e)},$addView:function(e,t){return this.$viewports[e]=t,t.saveKey=e,t},$getView:function(e){return this.$viewports[e]},$destroy:function(e){var t=e.saveKey;this.$viewports[t]&&delete this.$viewports[t]},$viewBack:function(e){var t=this.$getView(e);return!t||service.$back(t)},$back:function(e){var t=e.$viewContext.stack;if(0===t.length||1===t.length)return!0;t.pop(),service.$loadIndex(e,t[t.length-1],!0)},$parseUrlExp:function(view,urlExp){var result;if(/^#\d+/.test(urlExp)){var targetNo=urlExp.substr(1);result=targetNo>0?targetNo-1:0}else{if(!/^#[+-]\d+/.test(urlExp))throw Error("[v-page]:urlExp sync Error",urlExp);var history=view.$viewContext.historyPage||0;result=eval(history+urlExp.substr(1))}return result},$updateViewCtx:function(e,t,r){var n=e.$viewContext,i=n.stack;n.historyPage=n.activePage,n.activePage=t,r||n.stack.push(t);var o=i.indexOf(t);o>=0&&o!==i.length-1&&i.splice(o+1,i.length-1),$log.debug("[v-page]:history["+i.join(",")+"],currentPage:"+t+",lastPage:"+n.historyPage)},$loadIndex:function(e,t,r){var n=e.$pages[t].$element,i=$(n).controller("ngPage"),o=e.$viewContext.activePage;i.$load(function(){if(void 0!==o){var n=e.$pages[o].$element;$(n).controller("ngPage").$disable()}i.$enable(function(){service.$updateViewCtx(e,t,r)})})},$targetProxy:function(e,t,r){if(!TARGET_REG.test(t))throw targetError("$target","[v-page]:urlExp sync Error in $target(arg1,{0},arg3) second args!",t);var n=this.$getView(e);if(!n)throw targetError(404,"[v-page]: with id {0} isn't exist!",arguments[0]);if("#0"===t&&"function"==typeof service.$refreshCall)service.$refreshCall(n);else{var i=service.$parseUrlExp(n,t);service.$loadIndex(n,i,r)}}},window.$viewports=service.$viewports,angular.extend(forward,service)}Factory.$inject=["$window","$location","$log","$rootScope"],this.$get=Factory}var minErr=angular.$$minErr,targetError=minErr("$targets");ngPageController.$inject=["$scope","$element","$attrs","$rootScope","$templateRequest","$compile","$browser"],ngPageDirective.$inject=["$timeout","$targets"],angular.module("vviewport.vpage",[]),angular.module("vviewport.vpage").provider("$targets",$TargetsProvider).directive("ngPage",ngPageDirective),angular.module("vviewport.vpage").config(["$provide",function(e){e.decorator("ngControllerDirective",["$targets","$log","$delegate",function(e,t,r){return r[0].compile=function(){return{pre:function(r,n,i){var o,a,l=[];a=i.viewId||"content";var $,s;$=n.children(),angular.forEach($,function(e){if(e.hasAttribute("v-page")){var t={$element:e,$index:s=l.length+1};e.setAttribute("page-index",s),l.push(t)}}),l.length>0&&(t.debug("[v-page]:enable view in controller:"+i.ngController),n.attr("apply-view",a),o={$id:a,$pages:l,$viewContext:{historyPage:void 0,activePage:void 0},_$history:[]},Object.defineProperty(o,"$history",{configurable:!0,enumerable:!0,get:function(){return o._$history},set:function(e){o._$history=e}}),Object.defineProperty(o.$viewContext,"stack",{get:function(){return o._$history}}),n.data("$viewport",o),e.$addView(a||"content",o),r.$on("$destroy",function(){e.$destroy(o)}))}}},r}])}])}(window,window.angular),function(e){angular.module("vviewport.vpage").run(["$targets","$state","$stateParams",function(e,t,r){e.setRefreshCall(function(){t.transitionTo(t.current,r,{reload:!0,inherit:!0,notify:!0})})}])}(window);